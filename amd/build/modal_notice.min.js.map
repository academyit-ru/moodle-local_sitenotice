{"version":3,"sources":["../src/modal_notice.js"],"names":["define","$","Notification","Modal","ModalRegistry","KeyCodes","str","registered","SELECTORS","CLOSE_BUTTON","ACCEPT_BUTTON","ACK_CHECKBOX","CAN_RECEIVE_FOCUS","TOOL_TIP_WRAPPER","ATTRIBUTE","NOTICE_ID","REQUIRED_ACKNOWLEDGE","ModalNotice","root","call","getFooter","find","length","exception","message","TYPE","prototype","Object","create","constructor","register","getCloseButtonID","attr","getAcceptButtonID","getAckCheckboxID","setNoticeId","noticeid","getModal","getNoticeId","setRequiredAcknowledgement","reqack","modal","get_string","then","langString","body","getBody","checkboxdiv","ackcheckbox","type","id","labelspan","class","append","acceptbutton","show","tooltip","catch","css","turnoffToolTip","turnonToolTip","registerEventListeners","document","on","e","isVisible","keyCode","tab","handleTabLock","bind","preventDefault","target","activeElement","focusableElements","filter","firstFocusable","first","lastFocusable","last","focusable","previous","each","index","is","focus","shiftKey","next","get"],"mappings":"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","sourcesContent":["/**\n * Notice modal.\n * @author     Nathan Nguyen <nathannguyen@catalyst-au.net>\n * @copyright  Catalyst IT\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/notification', 'core/modal', 'core/modal_registry', 'core/key_codes', 'core/str'],\n    function($, Notification, Modal, ModalRegistry, KeyCodes, str) {\n\n        var registered = false;\n\n        var SELECTORS = {\n            CLOSE_BUTTON: '[data-action=\"close\"]',\n            ACCEPT_BUTTON: '[data-action=\"accept\"]',\n            ACK_CHECKBOX: 'sitenotice-modal-ackcheckbox',\n            CAN_RECEIVE_FOCUS: 'input:not([type=\"hidden\"]), a[href], button:not([disabled])',\n            TOOL_TIP_WRAPPER: '#tooltip-wrapper',\n        };\n\n        var ATTRIBUTE = {\n            NOTICE_ID: 'data-noticeid',\n            REQUIRED_ACKNOWLEDGE: 'data-noticereqack',\n        };\n\n        var ModalNotice = function(root) {\n            Modal.call(this, root);\n\n            if (!this.getFooter().find(SELECTORS.CLOSE_BUTTON).length) {\n                Notification.exception({message: 'No close button found'});\n            }\n\n            if (!this.getFooter().find(SELECTORS.ACCEPT_BUTTON).length) {\n                Notification.exception({message: 'No accept button found'});\n            }\n        };\n\n        ModalNotice.TYPE = 'local_sitenotice';\n        ModalNotice.prototype = Object.create(Modal.prototype);\n        ModalNotice.prototype.constructor = ModalNotice;\n\n        if (!registered) {\n            ModalRegistry.register(ModalNotice.TYPE, ModalNotice, 'local_sitenotice/modal_notice');\n            registered = true;\n        }\n\n        /**\n         * Get ID of close button.\n         * @returns {string}\n         */\n        ModalNotice.prototype.getCloseButtonID = function() {\n            return '#' + this.getFooter().find(SELECTORS.CLOSE_BUTTON).attr('id');\n        };\n\n        /**\n         * Get ID of accept button.\n         * @returns {string}\n         */\n        ModalNotice.prototype.getAcceptButtonID = function() {\n            return '#' + this.getFooter().find(SELECTORS.ACCEPT_BUTTON).attr('id');\n        };\n\n        /**\n         * Get ID of accept button.\n         * @returns {string}\n         */\n        ModalNotice.prototype.getAckCheckboxID = function() {\n            return '#' + SELECTORS.ACK_CHECKBOX;\n        };\n\n        /**\n         * Set Notice ID to the current modal.\n         * @param {Integer} noticeid\n         */\n        ModalNotice.prototype.setNoticeId = function(noticeid) {\n            this.getModal().attr(ATTRIBUTE.NOTICE_ID, noticeid);\n        };\n\n        /**\n         * Get the current notice id.\n         * @returns {*}\n         */\n        ModalNotice.prototype.getNoticeId = function() {\n            return this.getModal().attr(ATTRIBUTE.NOTICE_ID);\n        };\n\n        /**\n         * Add Checkbox if the notice requires acknowledgement.\n         * @param {Integer} reqack\n         */\n        ModalNotice.prototype.setRequiredAcknowledgement = function(reqack) {\n            var modal  = this;\n            if (reqack === 1) {\n                str.get_string('modal:checkboxtext', 'local_sitenotice').then(function(langString) {\n                    var body = modal.getBody();\n                    var checkboxdiv = $(\"<div>\", {});\n                    var ackcheckbox = $(\"<input>\", {type: \"checkbox\", id: SELECTORS.ACK_CHECKBOX});\n                    var labelspan = $(\"<span>\", {class: \"checkboxlabel\"});\n                    labelspan.append(langString);\n                    checkboxdiv.append(ackcheckbox);\n                    checkboxdiv.append(labelspan);\n                    body.append(checkboxdiv);\n                    var acceptbutton = modal.getFooter().find(SELECTORS.ACCEPT_BUTTON);\n                    acceptbutton.show();\n                    acceptbutton.attr('disabled', true);\n                    // Tooltip for disabled box.\n                    modal.getFooter().find(SELECTORS.TOOL_TIP_WRAPPER).tooltip();\n                }).catch(Notification.exception);\n            } else {\n                this.getFooter().find(SELECTORS.ACCEPT_BUTTON).css('display', 'none');\n            }\n        };\n\n        /**\n         * Turn off tool tip\n         */\n        ModalNotice.prototype.turnoffToolTip = function() {\n            this.getFooter().find(SELECTORS.TOOL_TIP_WRAPPER).tooltip('disable');\n        };\n\n        /**\n         * Turn on tool tip\n         */\n        ModalNotice.prototype.turnonToolTip = function() {\n            this.getFooter().find(SELECTORS.TOOL_TIP_WRAPPER).tooltip('enable');\n        };\n\n        /**\n         * Remove escape key event.\n         */\n        ModalNotice.prototype.registerEventListeners = function() {\n            $(document).on('keydown', function(e) {\n                if (!this.isVisible()) {\n                    return;\n                }\n\n                if (e.keyCode == KeyCodes.tab) {\n                    this.handleTabLock(e);\n                }\n\n            }.bind(this));\n\n            $(document).on('mousedown', function(e) {\n                if (!this.isVisible()) {\n                    return;\n                }\n                e.preventDefault();\n\n            }.bind(this));\n        };\n\n        /**\n         * CAN_RECEIVE_FOCUS in modal.js does not check if the disabled or hidden button\n         * @param {Event} e\n         */\n        ModalNotice.prototype.handleTabLock = function(e) {\n            var target = $(document.activeElement);\n\n            var focusableElements = this.modal.find(SELECTORS.CAN_RECEIVE_FOCUS).filter(\":visible\");\n            var firstFocusable = focusableElements.first();\n            var lastFocusable = focusableElements.last();\n\n            var focusable = false;\n            var previous = 0;\n            focusableElements.each(function(index) {\n                if (target.is(this)) {\n                    focusable = true;\n                    previous = index;\n                }\n            });\n\n            // Focus to first element.\n            if (focusable == false) {\n                e.preventDefault();\n                firstFocusable.focus();\n                return;\n            } else {\n                if (target.is(firstFocusable) && e.shiftKey) {\n                    lastFocusable.focus();\n                    e.preventDefault();\n                } else if (target.is(lastFocusable) && !e.shiftKey) {\n                    firstFocusable.focus();\n                    e.preventDefault();\n                } else {\n                    if (!e.shiftKey) {\n                        var next = focusableElements.get(previous+1);\n                    } else {\n                        var next = focusableElements.get(previous-1);\n                    }\n                    next.focus();\n                    e.preventDefault();\n                }\n            }\n        };\n\n        return ModalNotice;\n    }\n);\n"],"file":"modal_notice.min.js"}