define(["jquery","core/ajax"],function(a,b){function c(){for(var a in i)if(!j.includes(a))return j.push(a),i[a];return!1}function d(b){var d=c();if(0==d)return!1;var h=a("<div>",{id:"sitenotice-modal",tabindex:"0"}),i=a("<div>",{id:"sitenotice-modal-content"}),j=a("<div>",{id:"sitenotice-modal-content-header"}),k=a("<div>",{id:"sitenotice-modal-content-body"}),l=a("<div>",{id:"sitenotice-modal-content-footer"}),m=a("<button>",{id:"sitenotice-modal-content-footer-closebutton"}),n=a("<button>",{id:"sitenotice-modal-content-footer-ackbutton"}),o=a("<p>");h.attr("data-noticeid",d.id),h.attr("data-userid",b),j.html("<h2>"+d.title+"</h2>"),k.html(d.content),m.html("Close"),n.html("I acknowledge"),o.append(m),o.append(n),l.append(o),i.append(j),i.append(k),i.append(l),h.append(i),a("body").append(h),a("body").on("click","#sitenotice-modal-content-footer-closebutton",function(){var b=a("#sitenotice-modal").attr("data-noticeid");f(b),e()}),a("body").on("click","#sitenotice-modal-content-footer-ackbutton",function(){var b=a("#sitenotice-modal").attr("data-noticeid");g(b),e()})}function e(){a("#sitenotice-modal").fadeOut("slow",function(){var b=c();0!=b&&(a("#sitenotice-modal").attr("data-noticeid",b.id),a("#sitenotice-modal-content-header").html("<h2>"+b.title+"</h2>"),a("#sitenotice-modal-content-body").html(b.content),a("#sitenotice-modal").fadeIn("slow"))})}function f(a){var c=b.call([{methodname:"local_sitenotice_dismiss",args:{noticeid:a}}]);c[0].done(function(a){a.redirecturl&&window.open(a.redirecturl,"_parent","")}).fail(function(a){this.console.log(a)})}function g(a){var c=b.call([{methodname:"local_sitenotice_acknowledge",args:{noticeid:a}}]);c[0].done(function(a){a.redirecturl&&window.open(a.redirecturl,"_parent","")}).fail(function(a){this.console.log(a)})}var h={},i={},j=[];return h.init=function(b,c){i=JSON.parse(b),d(c),a(document).ready(function(){a("#sitenotice-modal").fadeIn("slow"),a("#sitenotice-modal").focus()})},h});