define(["jquery","core/ajax","core/modal_factory","local_sitenotice/modal_notice"],function(a,b,c,d){var e,f={},g=[],h={},i=function(){for(var a in f)if(!g.includes(a))return g.push(a),f[a];return!1},j=function(){var b=i();0!=b&&("undefined"==typeof e?c.create({type:d.TYPE,title:b.title,body:b.content,large:!0}).then(function(c){e=c,e.setNoticeId(b.id),e.setRequiredAcknowledgement(b.reqack),e.getModal().on("click",e.getCloseButtonID(),function(){k(),e.hide()}),e.getModal().on("click",e.getAcceptButtonID(),function(){l(),e.hide()}),e.getModal().on("click","a",function(){var b=a(this).attr("data-linkid");m(b)}),e.getModal().on("click",e.getAckCheckboxID(),function(){var b=a(e.getAckCheckboxID()).is(":checked");a(e.getAcceptButtonID()).attr("disabled",!b),b?e.turnoffToolTip():e.turnonToolTip()}),e.show()}):(e.setTitle(b.title),e.setBody(b.content),e.setNoticeId(b.id),e.setRequiredAcknowledgement(b.reqack),e.show()))},k=function(){var a=e.getNoticeId(),c=b.call([{methodname:"local_sitenotice_dismiss",args:{noticeid:a}}]);c[0].done(function(a){a.redirecturl?window.open(a.redirecturl,"_parent",""):j()}).fail(function(a){this.console.log(a)})},l=function(){var a=e.getNoticeId(),c=b.call([{methodname:"local_sitenotice_acknowledge",args:{noticeid:a}}]);c[0].done(function(a){a.redirecturl?window.open(a.redirecturl,"_parent",""):j()}).fail(function(a){this.console.log(a)})},m=function(a){var c=b.call([{methodname:"local_sitenotice_tracklink",args:{linkid:a}}]);c[0].done(function(a){a.redirecturl&&window.open(a.redirecturl,"_parent","")}).fail(function(a){this.console.log(a)})};return h.init=function(){var c=b.call([{methodname:"local_sitenotice_getnotices",args:{}}]);c[0].done(function(b){f=JSON.parse(b.notices),a(document).ready(function(){j()})}).fail(function(a){this.console.log(a)})},h});