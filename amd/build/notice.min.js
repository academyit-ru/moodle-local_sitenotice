define(["jquery","core/ajax"],function(a,b){function c(){for(var a in l)if(!m.includes(a))return m.push(a),l[a];return!1}function d(b){var d=c();if(0==d)return!1;var k=a("<div>",{id:"sitenotice-modal",tabindex:"0"}),l=a("<div>",{id:"sitenotice-modal-content"}),m=a("<div>",{id:"sitenotice-modal-content-header"}),n=a("<div>",{id:"sitenotice-modal-content-body"}),o=a("<div>",{id:"sitenotice-modal-content-footer"});k.attr("data-userid",b),l.append(m),l.append(n),l.append(o),k.append(l),a("body").append(k),e(d),k.on("click","#sitenotice-modal-content-footer-closebutton",function(){var b=a("#sitenotice-modal").attr("data-noticeid");h(b),g()}),k.on("click","#sitenotice-modal-content-footer-ackbutton",function(){var b=a("#sitenotice-modal").attr("data-noticeid");i(b),g()}),k.on("click","#sitenotice-modal-content-body-ackcheckbox",function(){f()}),k.on("click","a",function(){var b=a(this).attr("data-linkid");j(b)})}function e(b){var c=a("#sitenotice-modal"),d=a("#sitenotice-modal-content-header"),e=a("#sitenotice-modal-content-body"),f=a("#sitenotice-modal-content-footer");c.attr("data-noticeid",b.id),d.html("<h2>"+b.title+"</h2>"),e.html(b.content),f.empty();var g=a("<p>"),h=a("<button>",{id:"sitenotice-modal-content-footer-closebutton"});if(h.html("CLOSE"),g.append(h),1==b.reqack){var i=a("<input>",{type:"checkbox",id:"sitenotice-modal-content-body-ackcheckbox"}),j="I have read and understand the notice. Close this notice will log you off this site.",k=a("<label>",{"for":"sitenotice-modal-content-body-ackcheckboxlabel",text:j});e.append(i),e.append(k);var l=a("<button>",{id:"sitenotice-modal-content-footer-ackbutton"});l.html("ACCEPT"),l.attr("disabled",!0),g.append(l)}f.append(g)}function f(){a("#sitenotice-modal-content-footer-ackbutton").attr("disabled",!a("#sitenotice-modal-content-body-ackcheckbox").is(":checked"))}function g(){a("#sitenotice-modal").fadeOut("slow",function(){var b=c();0!=b&&(e(b),a("#sitenotice-modal").fadeIn("slow"))})}function h(a){var c=b.call([{methodname:"local_sitenotice_dismiss",args:{noticeid:a}}]);c[0].done(function(a){a.redirecturl&&window.open(a.redirecturl,"_parent","")}).fail(function(a){this.console.log(a)})}function i(a){var c=b.call([{methodname:"local_sitenotice_acknowledge",args:{noticeid:a}}]);c[0].done(function(a){a.redirecturl&&window.open(a.redirecturl,"_parent","")}).fail(function(a){this.console.log(a)})}function j(a){var c=b.call([{methodname:"local_sitenotice_tracklink",args:{linkid:a}}]);c[0].done(function(a){a.redirecturl&&window.open(a.redirecturl,"_parent","")}).fail(function(a){this.console.log(a)})}var k={},l={},m=[];return k.init=function(b,c){l=JSON.parse(b),d(c),a(document).ready(function(){a("#sitenotice-modal").fadeIn("slow"),a("#sitenotice-modal").focus()})},k});