define(["jquery","core/ajax"],function(a,b){function c(){for(var a in j)if(!k.includes(a))return k.push(a),j[a];return!1}function d(b){var d=c();if(0==d)return!1;var i=a("<div>",{id:"sitenotice-modal",tabindex:"0"}),j=a("<div>",{id:"sitenotice-modal-content"}),k=a("<div>",{id:"sitenotice-modal-content-header"}),l=a("<div>",{id:"sitenotice-modal-content-body"}),m=a("<div>",{id:"sitenotice-modal-content-footer"}),n=a("<button>",{id:"sitenotice-modal-content-footer-closebutton"}),o=a("<button>",{id:"sitenotice-modal-content-footer-ackbutton"}),p=a("<p>");i.attr("data-noticeid",d.id),i.attr("data-userid",b),k.html("<h2>"+d.title+"</h2>"),l.html(d.content),n.html("Close"),o.html("I acknowledge"),p.append(n),p.append(o),m.append(p),j.append(k),j.append(l),j.append(m),i.append(j),a("body").append(i),i.on("click","#sitenotice-modal-content-footer-closebutton",function(){var b=a("#sitenotice-modal").attr("data-noticeid");f(b),e()}),i.on("click","#sitenotice-modal-content-footer-ackbutton",function(){var b=a("#sitenotice-modal").attr("data-noticeid");g(b),e()}),i.on("click","a",function(){var b=a(this).attr("data-linkid");h(b)})}function e(){a("#sitenotice-modal").fadeOut("slow",function(){var b=c();0!=b&&(a("#sitenotice-modal").attr("data-noticeid",b.id),a("#sitenotice-modal-content-header").html("<h2>"+b.title+"</h2>"),a("#sitenotice-modal-content-body").html(b.content),a("#sitenotice-modal").fadeIn("slow"))})}function f(a){var c=b.call([{methodname:"local_sitenotice_dismiss",args:{noticeid:a}}]);c[0].done(function(a){a.redirecturl&&window.open(a.redirecturl,"_parent","")}).fail(function(a){this.console.log(a)})}function g(a){var c=b.call([{methodname:"local_sitenotice_acknowledge",args:{noticeid:a}}]);c[0].done(function(a){a.redirecturl&&window.open(a.redirecturl,"_parent","")}).fail(function(a){this.console.log(a)})}function h(a){var c=b.call([{methodname:"local_sitenotice_tracklink",args:{linkid:a}}]);c[0].done(function(a){a.redirecturl&&window.open(a.redirecturl,"_parent","")}).fail(function(a){this.console.log(a)})}var i={},j={},k=[];return i.init=function(b,c){j=JSON.parse(b),d(c),a(document).ready(function(){a("#sitenotice-modal").fadeIn("slow"),a("#sitenotice-modal").focus()})},i});