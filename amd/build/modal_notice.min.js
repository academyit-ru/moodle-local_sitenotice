define(["jquery","core/notification","core/modal","core/modal_registry","core/key_codes","core/str"],function(a,b,c,d,e,f){var g=!1,h={CLOSE_BUTTON:'[data-action="close"]',ACCEPT_BUTTON:'[data-action="accept"]',ACK_CHECKBOX:"sitenotice-modal-ackcheckbox",CAN_RECEIVE_FOCUS:'input:not([type="hidden"]), a[href], button:not([disabled])',TOOL_TIP_WRAPPER:"#tooltip-wrapper"},i={NOTICE_ID:"data-noticeid",REQUIRED_ACKNOWLEDGE:"data-noticereqack"},j=function(a){c.call(this,a),this.getFooter().find(h.CLOSE_BUTTON).length||b.exception({message:"No close button found"}),this.getFooter().find(h.ACCEPT_BUTTON).length||b.exception({message:"No accept button found"})};return j.TYPE="local_sitenotice",j.prototype=Object.create(c.prototype),j.prototype.constructor=j,g||(d.register(j.TYPE,j,"local_sitenotice/modal_notice"),g=!0),j.prototype.getCloseButtonID=function(){return"#"+this.getFooter().find(h.CLOSE_BUTTON).attr("id")},j.prototype.getAcceptButtonID=function(){return"#"+this.getFooter().find(h.ACCEPT_BUTTON).attr("id")},j.prototype.getAckCheckboxID=function(){return"#"+h.ACK_CHECKBOX},j.prototype.setNoticeId=function(a){this.getModal().attr(i.NOTICE_ID,a)},j.prototype.getNoticeId=function(){return this.getModal().attr(i.NOTICE_ID)},j.prototype.setRequiredAcknowledgement=function(c){var d=this;1==c?f.get_string("modal:checkboxtext","local_sitenotice").then(function(b){var c=d.getBody(),e=a("<div>",{}),f=a("<input>",{type:"checkbox",id:h.ACK_CHECKBOX}),g=b;e.append(f),e.append(g),c.append(e),d.getFooter().find(h.ACCEPT_BUTTON).attr("disabled",!0),d.getFooter().find(h.TOOL_TIP_WRAPPER).tooltip()})["catch"](b.exception):this.getFooter().find(h.ACCEPT_BUTTON).css("display","none")},j.prototype.turnoffToolTip=function(){this.getFooter().find(h.TOOL_TIP_WRAPPER).tooltip("disable")},j.prototype.turnonToolTip=function(){this.getFooter().find(h.TOOL_TIP_WRAPPER).tooltip("enable")},j.prototype.registerEventListeners=function(){a(document).on("keydown",function(a){this.isVisible()&&a.keyCode==e.tab&&this.handleTabLock(a)}.bind(this)),a(document).on("mousedown",function(a){this.isVisible()&&a.preventDefault()}.bind(this))},j.prototype.handleTabLock=function(b){var c=a(document.activeElement),d=this.modal.find(h.CAN_RECEIVE_FOCUS).filter(":visible"),e=d.first(),f=d.last(),g=!1,i=0;if(d.each(function(a){c.is(this)&&(g=!0,i=a)}),0==g)return b.preventDefault(),void e.focus();if(c.is(e)&&b.shiftKey)f.focus(),b.preventDefault();else if(c.is(f)&&!b.shiftKey)e.focus(),b.preventDefault();else{if(b.shiftKey)var j=d.get(i-1);else var j=d.get(i+1);j.focus(),b.preventDefault()}},j});