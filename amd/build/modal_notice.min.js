define(["jquery","core/notification","core/modal","core/modal_registry","core/key_codes"],function(a,b,c,d,e){var f=!1,g={CLOSE_BUTTON:'[data-action="close"]',ACCEPT_BUTTON:'[data-action="accept"]',ACK_CHECKBOX:"sitenotice-modal-ackcheckbox",CAN_RECEIVE_FOCUS:'input:not([type="hidden"]), a[href], button:not([disabled])'},h={NOTICE_ID:"data-noticeid",REQUIRED_ACKNOWLEDGE:"data-noticereqack"},i=function(a){c.call(this,a),this.getFooter().find(g.CLOSE_BUTTON).length||b.exception({message:"No close button found"}),this.getFooter().find(g.ACCEPT_BUTTON).length||b.exception({message:"No accept button found"})};return i.TYPE="local_sitenotice",i.prototype=Object.create(c.prototype),i.prototype.constructor=i,f||(d.register(i.TYPE,i,"local_sitenotice/modal_notice"),f=!0),i.prototype.getCloseButtonID=function(){return"#"+this.getFooter().find(g.CLOSE_BUTTON).attr("id")},i.prototype.getAcceptButtonID=function(){return"#"+this.getFooter().find(g.ACCEPT_BUTTON).attr("id")},i.prototype.getAckCheckboxID=function(){return"#"+g.ACK_CHECKBOX},i.prototype.setNoticeId=function(a){this.getModal().attr(h.NOTICE_ID,a)},i.prototype.getNoticeId=function(){return this.getModal().attr(h.NOTICE_ID)},i.prototype.setRequiredAcknowledgement=function(b){if(1==b){var c=this.getBody(),d=a("<input>",{type:"checkbox",id:g.ACK_CHECKBOX}),e="I have read and understand the notice (Closing this notice will log you off this site).",f=a("<label>",{"for":g.ACK_CHECKBOX,text:e});c.append(d),c.append(f),this.getFooter().find(g.ACCEPT_BUTTON).attr("disabled",!0)}else this.getFooter().find(g.ACCEPT_BUTTON).css("display","none")},i.prototype.registerEventListeners=function(){this.getRoot().on("keydown",function(a){this.isVisible()&&a.keyCode==e.tab&&this.handleTabLock(a)}.bind(this))},i.prototype.handleTabLock=function(b){if(this.hasFocus()){var c=a(document.activeElement),d=this.modal.find(g.CAN_RECEIVE_FOCUS),e=d.first(),f=d.last();c.is(e)&&b.shiftKey?(f.focus(),b.preventDefault()):c.is(f)&&!b.shiftKey&&(e.focus(),b.preventDefault())}},i});